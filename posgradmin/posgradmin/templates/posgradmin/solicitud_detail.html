{% extends "posgradmin/posgradmin_base.html" %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  {% for crumb in breadcrumbs %}
  &rsaquo; <a href="{{ crumb.0 }}">{{ crumb.1 }}</a>
  {% endfor %}

  &rsaquo; <a href="/inicio">Inicio</a>
  &rsaquo; <a href="/inicio/solicitudes/">Solicitudes</a>
  &rsaquo; <a href="/inicio/solicitudes/{{ object.id }}/">#{{ object.id }}</a>
</div>
{% endblock %}




{% block title %}Solicitud #{{ object.id }}{% endblock %}

{% block content %}

<h1>solicitud #{{ object.id }}</h1>
<div class="panel panel-info">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>{{ object.fecha_creacion }} por {{ object.solicitante.get_full_name }}</h3>
  </div>
  <div class="panel-body">
    <h3>{{ object.resumen }}</h3>
    <p>{{ object.descripcion }}
    </p>


    {% if object.tipo == "cambiar_comite_tutoral" %}
    {% if object.comite_set.all %}
    <h4>Comité elegido:</h4>
    {{ object.comite_set.all.first.as_ul | safe }}
    {% else %}
    <div class="alert alert-danger" role="alert">
      <strong>No ha hecho una elección</strong>.
      <a href="elegir-comite-tutoral">Elegir comité tutoral</a>.
    </div>
    {% endif %}
    {% endif %}

    {% if object.tipo == "seleccionar_jurado_candidatura" %}
    {% if object.comite_set.all %}
    <h4>Jurado elegido:</h4>
    {{ object.comite_set.all.first.as_ul | safe }}
    {% else %}
    <div class="alert alert-danger" role="alert">
      <strong>No se ha elegido jurado.</strong>.
      <a href="elegir-jurado-candidatura">Elegir Jurado de Candidatura</a>.
    </div>
    {% endif %}
    {% endif %}

    {% if object.tipo == "seleccionar_jurado_grado" %}
    {% if object.comite_set.all %}
    <h4>Jurado elegido:</h4>
    {{ object.comite_set.all.first.as_ul | safe }}
    {% else %}
    <div class="alert alert-danger" role="alert">
      <strong>No se ha elegido jurado.</strong>.
      <a href="elegir-jurado-grado">Elegir Jurado de Grado</a>.
    </div>
    {% endif %}
    {% endif %}


    {% if object.tipo == "cambio_proyecto" %}
    {% if object.proyecto_set.all %}
    {{ object.proyecto_set.all.last }}
    {% else %}
    <div class="alert alert-danger" role="alert">
      <strong>No se han especificado cambios al proyecto.</strong>.
      <a href="cambiar-proyecto">Cambiar proyecto</a>.
    </div>
    {% endif %}
    {% endif %}


    {% if object.tipo == "registrar_curso" %}
    {% if object.curso_set.all %}
    {{ object.curso_set.all.last }}
    {% else %}
    <div class="alert alert-danger" role="alert">
      <strong>No se ha registrado curso.</strong>.
      <a href="cambio-proyecto">registrar curso</a>.
    </div>
    {% endif %}
    {% endif %}


    {% if object.tipo == "registrar_academico" and user == object.solicitante %}
      Para ser registrado como académico es necesario que agregue sus adscripciones a su perfil.
      <a href="/inicio/perfil/editar">Editar mi perfil</a>.
    {% endif %}


  </div>

  <div class="panel-footer">
    <ul>
      {% if user.asistente or user.is_staff %}
      {% if object.estado == 'nueva' %}
      <li><a href="estado/agendada">Agendar solicitud para próxima Asamblea del Consejo</a></li>
      <li><a href="estado/cancelada" onclick="return confirm('¿cancelar solicitud?')">Cancelar</a></li>
      {% elif object.estado == 'agendada' %}
      <li><a href="dictaminar">Emitir dictamen</a></li>
      {% endif %}

      
      {% elif user.academico %}
      {% if object.solicitante == user and object.estado == 'nueva' %}
      <li><a href="estado/cancelada" onclick="return confirm('¿cancelar solicitud?')">Cancelar</a></li>
      {% endif %}

      
      {% elif user.estudiante %}
      {% if object.solicitante == user and object.estado == 'nueva' %}
      <li><a href="estado/cancelada" onclick="return confirm('¿cancelar solicitud?')">Cancelar</a></li>
      {% endif %}
      {% endif %}
    </ul>
  </div>

  <div class="panel-footer">
      <strong>tipo:</strong> {{ object.tipo }} |
      <strong>estado:</strong> {{ object.estado }}
      {% if object.dictamen_final %}
      | <strong>dictamen</strong>: {{ object.dictamen_final.resolucion }}
      {% endif %}

  </div>
</div>


{% block dictamen_form %}
{% endblock %}


<h3>Anexos</h3>

{% block anexo_form %}
{% if object.estado != 'cancelada' and object.estado != 'atendida' %}
<a href="anexar"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span> subir anexo</a>
{% endif %}
{% endblock %}

{% if object.anexo_set.count %}
<div class="row">
  <div class="col-sm-8">
    <ul class="list-group">
      {% for anexo in object.anexo_set.all %}
      <li class="list-group-item">
	<a href="/inicio/solicitudes/{{ object.id }}/anexos/{{ anexo.archivo }}">
	  <strong>
	  <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
	  {{ anexo.archivo }}</a></strong>
	anexado el {{ anexo.fecha }} por
	{{ anexo.autor.get_full_name }}
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}


<h3>Comentarios</h3>

{% block comment_form %}
{% if object.estado != 'cancelada' and object.estado != 'atendida' %}
<a href="comentar"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span> agregar comentario</a>
{% endif %}
{% endblock %}

{% if object.comentario_set.count %}
  {% for comentario in object.comentario_set.all %}
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <span class="glyphicon glyphicon-comment" aria-hidden="true"></span>
      {{ comentario.fecha }} por
      {{ comentario.autor.get_full_name }}</h3>

  </div>

  <div class="panel-body">
    {{ comentario.comentario }}
  </div>
</div>

  {% endfor %}
</ul>
{% endif %}

{% endblock %}
